<!DOCTYPE html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Hugy : Golang Gui for Hugo</title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bulma/0.7.0/css/bulma.min.css">
    <script defer src="https://use.fontawesome.com/releases/v5.0.7/js/all.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
</head>

<body>
<div id="app">
    <section class="hero is-primary">
        <div class="hero-body">
            <div class="container">
                <h1 class="title">
                    Hugy : Golang Gui for Hugo
                </h1>
                <div>{{version}}</div>
            </div>
        </div>
    </section>
    <section  class="section">
        <div class="container">
            <div>
                <button @click="StartHugoServer">StartHugoServer</button>
                <button @click="StopHugoServer">StopHugoServer</button>
                <button @click="StatusHugoServer">StatusHugoServer</button>
                <button @click="VersionHugoServer">VersionHugoServer</button>
            </div>
            <div class="console-screen break-words flex-grow" v-if="console && console.length > 0">
                <div class="my-2 text-xs even:bg-gray-200" v-for="msg in console" v-html="msg"></div>
            </div>
        </div>
    </section>
</div>
<script>
    window.addEventListener("load", function(event) {
        new Vue({
            el: '#app',
            data() {
                return {
                    console: [],
                    version:"",
                    ws: ""
                }
            },
            methods: {
                async StartHugoServer() {
                    console.log("start hugo server")
                    window.startserver().then(resp=>{
                        console.log("starter : " + resp)
                        if (resp == "Server already running") {
                            this.StatusHugoServer()
                        }else{
                            this.console = []
                            this.console.push(resp)
                        }
                    }).catch(err=>{
                        console.log(err)
                    })
                },
                StatusHugoServer() {
                    window.serverstatus().then(resp=>{
                        console.log(resp)
                        this.console.push(resp)
                    }).catch(err=>{
                        console.log(err)
                    })
                },
                StopHugoServer() {
                    window.stopserver().then(resp=>{
                        console.log(resp)
                        this.console.push(resp)
                    }).catch(err=>{
                        console.log(err)
                    })
                },
                VersionHugoServer() {
                    window.serverversion().then(resp=>{
                        console.log(resp)
                        this.version = resp
                    }).catch(err=>{
                        console.log(err)
                    })
                },
            },
            mounted() {
                var loc = window.location;
                var uri = 'ws:';

                if (loc.protocol === 'https:') {
                    uri = 'wss:';
                }
                uri += '//' + loc.host;
                uri += loc.pathname + 'ws';
                this.ws = new WebSocket(uri)

                this.ws.onconnect = (evt) => {
                    console.log("ws connected", evt)
                }
                this.ws.onclose = (evt) => {
                    console.log("ws closed", evt)
                }
                this.ws.onmessage = (evt) => {
                    console.log("ws got message", evt.data)
                    this.console.push(evt.data)
                }
                this.VersionHugoServer()
            }
        });
    });

</script>

</body>

</html>